{"files":[{"id":"ab2c781f-ea82-4e42-a27b-015eb0f60f8c","name":"appsscript","type":"json","source":"{\n  \"timeZone\": \"Europe/Rome\",\n  \"dependencies\": {},\n  \"exceptionLogging\": \"STACKDRIVER\",\n  \"runtimeVersion\": \"V8\",\n  \"webapp\": {\n    \"executeAs\": \"USER_ACCESSING\",\n    \"access\": \"ANYONE\"\n  }\n}"},{"id":"508b976c-fbe1-410d-b7e5-6ad238a3d363","name":"Codice","type":"server_js","source":"function doGet() {\n  return HtmlService.createHtmlOutputFromFile(\u0027index\u0027)\n    .setTitle(\"Intesa Vincente\");\n}\n\n//AIzaSyBz4QLEs853fPjcRMRiEybpkxenrHR3T5Y\n// üîπ Chiama Gemini con un prompt\nfunction chiamaGemini(prompt) {\n  const apiKey \u003d \"my-key\";\n  const url \u003d\n    \"https://generativelanguage.googleapis.com/v1beta/models/gemma-3-27b-it:generateContent?key\u003d\" +\n    apiKey;\n\n  const payload \u003d {\n    contents: [{ parts: [{ text: prompt }] }]\n  };\n\n  const options \u003d {\n    method: \"post\",\n    contentType: \"application/json\",\n    payload: JSON.stringify(payload)\n  };\n\n  const response \u003d UrlFetchApp.fetch(url, options);\n  const json \u003d JSON.parse(response.getContentText());\n  return json.candidates[0].content.parts[0].text.trim();\n}\n\n// üîπ Genera una parola segreta leggendo da un file di Drive\nfunction generaParolaSegreta() {\n  const fileId \u003d \u00271Gfx-mS3f_o6edcfviCn4cCRbNx3u6N-5\u0027; // ID file su Drive\n  const file \u003d DriveApp.getFileById(fileId);\n  const contenuto \u003d file.getBlob().getDataAsString();\n\n  const parole \u003d contenuto\n    .split(\u0027, \u0027)\n    .map(p \u003d\u003e p.trim())\n    .filter(p \u003d\u003e p.length \u003e 0);\n\n  const indiceCasuale \u003d Math.floor(Math.random() * parole.length);\n  return parole[indiceCasuale];\n}\n\n// üîπ Genera la parola successiva con AI\nfunction turnoLLM(parolaSegreta, sequenza) {\n  const prompt \u003d `\nStai giocando a Intesa Vincente con Giocatore 1 e Giocatore 2.\nTu e Giocatore 2 dovete fare indovinare la parola segreta al Giocatore 1\ncomponendo una frase indizio parola per parola alternando i turni.\nPuoi usare qualsiasi parola italiana. Non puoi usare la parola segreta, n√© i suoi derivati. Non aggiungere formattazioni.\n\nEsempi:\n- Se la parola segreta √® \"pizza\" e la sequenza √® [\"cibo\"], puoi rispondere con \"italiano\".\n- Se la parola segreta √® \"mago\" e la sequenza √® [\"uomo\", \"con\", \"poteri\"], puoi rispondere con \"magici\".\n- Se la parola segreta √® \"computer\" e la sequenza √® [\"strumento\", \"per\"], puoi rispondere con \"lavorare\".\n- Se la parola segreta √® \"calcio\" e la sequenza √® [\"sport\", \"pi√π\"], puoi rispondere con \"popolare\".\n- Se la parola segreta √® \"mucca\" e la sequenza √® [\"sinonimo\", \"di\"], puoi rispondere con \"vacca\".\n- Se la parola segreta √® \"puntura\" e la sequenza √® [\"cosa\", \"ti\", \"fa\", \"una\"], puoi rispondere con \"zanzara\".\n- Se la parola segreta √® \"single\" e la sequenza √® [\"non\", \"sposato\", \"n√©\"], puoi rispondere con \"fidanzato\".\n\nEsempi negativi:\nNon produrre sequenze agrammaticali come [\"il\", \"dell\u0027\"]\nNon produrre sequenze agrammaticali come [\"colui\", \"che\", \"indossare\"]\n\nLa parola segreta √® [${parolaSegreta}] e la sequenza gi√† generata √® [${sequenza}], \ngenera una sola parola grammaticalmente coerente con la sequenza per continuarla. \nAttenzione, non restituirmi la sequenza aggiornata ma soltanto la parola che hai scelto.\nGenera adesso la parola successiva per la sequenza corrente.\n`;\n  return chiamaGemini(prompt);\n}\n\n// üîπ Salva la partita su Google Sheets\nfunction salvaPartita(parolaSegreta, sequenza) {\n  const ss \u003d SpreadsheetApp.openById(\"1K0hP0iXCspeTDM4fOZjrJeOdKg9Ps9Szq7OCGUBvHic\"); // ID del tuo file Google Sheet\n  const sheet \u003d ss.getSheetByName(\"partite\"); // Nome del foglio (controlla che esista!)\n\n  const now \u003d new Date();\n  sheet.appendRow([\n    now,               // Timestamp\n    parolaSegreta,     // Parola segreta\n    sequenza.join(\" \") // Sequenza finale\n  ]);\n}"},{"id":"ab03e0a6-c2d4-43e5-a2c4-738d8aa7bcd9","name":"index","type":"html","source":"\u003c!DOCTYPE html\u003e\n\n\u003chtml\u003e\n\n\u003chead\u003e\n\n  \u003cmeta charset\u003d\"UTF-8\" /\u003e\n\n  \u003ctitle\u003eIntesa Vincente\u003c/title\u003e\n\n  \u003cstyle\u003e\n\n    body {\n\n      margin: 0;\n\n      padding: 0;\n\n      font-family: Arial, sans-serif;\n\n      height: 100vh;\n\n      display: flex;\n\n      align-items: center;\n\n      justify-content: center;\n\n      background: url(\"https://drive.google.com/thumbnail?id\u003d13vdLxf1Hs71rW--ZRvCCnAoGomX1nfuq\u0026sz\u003dw2000\")\n  no-repeat center center fixed;\n\n      background-size: cover;\n\n    }\n\n    .container {\n\n      background: rgba(255, 255, 255, 0.9);\n\n      padding: 30px;\n\n      border-radius: 20px;\n\n      box-shadow: 0px 4px 15px rgba(0, 0, 0, 0.2);\n\n      max-width: 600px;\n\n      width: 90%;\n\n      text-align: center;\n\n    }\n\n    .immagine-centrata {\n\n      position: fixed;\n\n      top: 0vw;\n\n      display: block;\n\n      margin: 0 auto;\n\n      width: 55vw;\n\n      height: auto;\n\n    }\n\n    .segreta {\n\n      font-size: 20px;\n\n      font-weight: bold;\n\n      margin-bottom: 15px;\n\n    }\n\n    .sequenza {\n\n      margin-top: 15px;\n\n      font-size: 18px;\n\n    }\n\n    .input-area {\n\n      margin-top: 15px;\n\n      display: none;\n\n    }\n\n    .loading {\n\n      margin-top: 20px;\n\n      display: none;\n\n      text-align: center;\n\n    }\n\n    input {\n\n      padding: 5px;\n\n      font-size: 16px;\n\n    }\n\n    button {\n\n      margin-top: 10px;\n\n      padding: 10px 20px;\n\n      font-size: 18px;\n\n      border-radius: 8px;\n\n      border: none;\n\n      cursor: pointer;\n\n      color: white;\n\n    }\n\n    button:hover {\n\n      opacity: 0.9;\n\n    }\n\n    .btn-primary {\n\n      background: #0077cc;\n\n    }\n\n    .btn-primary:hover {\n\n      background: #005fa3;\n\n    }\n\n    .btn-danger {\n\n      background: #E32C67;\n\n    }\n\n    .btn-danger:hover {\n\n      background: #c0265a;\n\n    }\n\n    .btn-success {\n\n      background: #866DC3;\n\n    }\n\n    .btn-success:hover {\n\n      background: #7054A8;\n\n    }\n\n    video {\n\n      width: 70px;\n\n      height: 70px;\n\n      border-radius: 10px;\n\n      box-shadow: 0 4px 10px rgba(0, 0, 255, 0.3);\n\n    }\n\n    /* Modal overlay */\n\n    #modalAI {\n\n      display: none;\n\n      position: fixed;\n\n      top: 0;\n\n      left: 0;\n\n      width: 100%;\n\n      height: 100%;\n\n      background: rgba(0, 0, 0, 0.5);\n\n      z-index: 100;\n\n      align-items: center;\n\n      justify-content: center;\n\n    }\n\n    #modalContent {\n\n      background: white;\n\n      padding: 30px;\n\n      border-radius: 15px;\n\n      text-align: center;\n\n      max-width: 400px;\n\n      width: 80%;\n\n      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);\n\n    }\n\n    #modalContent p {\n\n      font-size: 20px;\n\n      margin-bottom: 20px;\n\n    }\n\n    #modalContent button {\n\n      margin: 0 10px;\n\n      width: 100px;\n\n    }\n\n  \u003c/style\u003e\n\n  \u003cscript\u003e\n  let parolaSegreta \u003d \"\";\n  let sequenza \u003d [];\n  let startTime \u003d null;\n  let prossimaAzione \u003d null; // per capire se terminare o fare redo\n\n  function mostraGioco() {\n    document.getElementById(\"startScreen\").style.display \u003d \"none\";\n    document.getElementById(\"gameScreen\").style.display \u003d \"block\";\n    inizializza();\n  }\n\nfunction inizializza() {\n  const loadingParola \u003d document.getElementById(\"loadingParola\");\n  const parolaSegretaDiv \u003d document.getElementById(\"parolaSegreta\");\n  const inputArea \u003d document.getElementById(\"inputArea\");\n\n  // Nascondi area input e mostra caricamento\n  inputArea.style.display \u003d \"none\";\n  parolaSegretaDiv.style.display \u003d \"none\";\n  loadingParola.style.display \u003d \"block\";\n\n  google.script.run\n    .withSuccessHandler(function (parola) {\n      // Quando la parola √® pronta, nascondi il loading\n      loadingParola.style.display \u003d \"none\";\n\n      // Mostra la parola segreta\n      parolaSegreta \u003d parola;\n      parolaSegretaDiv.innerText \u003d \"ü§´ Parola da fare indovinare: \" + parolaSegreta;\n      parolaSegretaDiv.style.display \u003d \"block\";\n\n      // Mostra l\u0027input area\n      inputArea.style.display \u003d \"block\";\n\n      startTime \u003d Date.now();\n    })\n    .generaParolaSegreta();\n}\n\n  function inviaParolaUtente() {\n    const parola \u003d document.getElementById(\"inputParola\").value.trim();\n    if (!parola) return;\n\n    sequenza.push(parola);\n    aggiornaSequenza();\n\n    document.getElementById(\"inputParola\").value \u003d \"\";\n    document.getElementById(\"inputArea\").style.display \u003d \"none\";\n    document.getElementById(\"loading\").style.display \u003d \"block\";\n\n    google.script.run\n      .withSuccessHandler(function (parolaLLM) {\n        sequenza.push(parolaLLM);\n        aggiornaSequenza();\n        leggiParola(parolaLLM);\n        document.getElementById(\"loading\").style.display \u003d \"none\";\n        document.getElementById(\"inputArea\").style.display \u003d \"block\";\n      })\n      .turnoLLM(parolaSegreta, sequenza);\n  }\n\n  function aggiornaSequenza() {\n    document.getElementById(\"sequenza\").innerText \u003d \"Sequenza: \" + sequenza.join(\" \");\n  }\n\n  function leggiParola(parola) {\n    if (\"speechSynthesis\" in window) {\n      const utterance \u003d new SpeechSynthesisUtterance(parola);\n      utterance.lang \u003d \"it-IT\";\n      window.speechSynthesis.speak(utterance);\n    }\n  }\n\n  // Mostra il modal per valutare l\u0027AI solo se c\u0027√® un\u0027azione valida\n  function mostraModalAI() {\n    if (prossimaAzione \u003d\u003d\u003d \u0027termina\u0027 || prossimaAzione \u003d\u003d\u003d \u0027redo\u0027) {\n      document.getElementById(\"modalAI\").style.display \u003d \"flex\";\n    }\n  }\n\n  function terminaGioco() {\n    prossimaAzione \u003d \u0027termina\u0027;\n    mostraModalAI();\n  }\n\n  function redoGioco() {\n    prossimaAzione \u003d \u0027redo\u0027;\n    mostraModalAI();\n  }\n\n  function rispostaAI(risposta) {\n    sequenza.push(\"AI_aligned:\" + risposta); // salva valutazione AI\n    document.getElementById(\"modalAI\").style.display \u003d \"none\";\n\n    if (prossimaAzione \u003d\u003d\u003d \u0027termina\u0027) {\n      eseguiTerminaGioco();\n    } else if (prossimaAzione \u003d\u003d\u003d \u0027redo\u0027) {\n      eseguiRedoGioco();\n    }\n    prossimaAzione \u003d null; // reset dopo aver eseguito l\u0027azione\n  }\n\n  function eseguiTerminaGioco() {\n    const endTime \u003d Date.now();\n    const elapsedMs \u003d endTime - startTime;\n    const seconds \u003d Math.floor(elapsedMs / 1000);\n    const minutes \u003d Math.floor(seconds / 60);\n    const remainingSeconds \u003d seconds % 60;\n\n    google.script.run\n      .withSuccessHandler(() \u003d\u003e {\n        console.log(\"Partita terminata\");\n        sequenza \u003d [];\n        aggiornaSequenza();\n        document.getElementById(\"inputArea\").style.display \u003d \"none\";\n        document.getElementById(\"loading\").style.display \u003d \"none\";\n        document.getElementById(\"gameScreen\").style.display \u003d \"none\";\n        document.getElementById(\"startScreen\").style.display \u003d \"block\";\n      })\n      .withFailureHandler((err) \u003d\u003e {\n        alert(\"‚ùå Errore nel salvataggio: \" + err.message);\n      })\n      .salvaPartita(parolaSegreta, sequenza);\n  }\n\n  function eseguiRedoGioco() {\n    const endTime \u003d Date.now();\n    const elapsedMs \u003d endTime - startTime;\n    const seconds \u003d Math.floor(elapsedMs / 1000);\n    const minutes \u003d Math.floor(seconds / 60);\n    const remainingSeconds \u003d seconds % 60;\n\n    google.script.run\n      .withSuccessHandler(() \u003d\u003e {\n        console.log(\"Nuova parola in arrivo\");\n        sequenza \u003d [];\n        aggiornaSequenza();\n        document.getElementById(\"inputArea\").style.display \u003d \"none\";\n        document.getElementById(\"loading\").style.display \u003d \"none\";\n        inizializza();\n      })\n      .withFailureHandler((err) \u003d\u003e {\n        alert(\"‚ùå Errore nel salvataggio: \" + err.message);\n      })\n      .salvaPartita(parolaSegreta, sequenza);\n  }\n\u003c/script\u003e\n\n\u003c/head\u003e\n\n\u003cbody\u003e\n\n  \u003cimg src\u003d\"https://drive.google.com/thumbnail?id\u003d1WnjNqEWrbMy8siVV1PXL9EvDpNj4lApX\u0026sz\u003dw2000\"\n     alt\u003d\"Descrizione dell\u0027immagine\"\n     class\u003d\"immagine-centrata\" /\u003e\n\n\n  \u003c!-- Schermata iniziale --\u003e\n\n  \u003cdiv id\u003d\"startScreen\" class\u003d\"container\"\u003e\n\n    \u003ch2\u003eIstruzioni\u003c/h2\u003e\n\n    \u003cp style\u003d\"text-align: justify; font-family: Helvetica, sans-serif;\"\u003e\n\n    La parola segreta verr√† mostrata in alto. Per comporre la frase indizio inserisci una parola nell‚Äôapposito spazio e inviala. L‚ÄôAI aggiunger√† la sua. Continuate a turno finch√© il compagno indovina.\n\n    \u003c/p\u003e\n\n    \u003cbutton class\u003d\"btn-primary\" onclick\u003d\"mostraGioco()\"\u003eGIOCA\u003c/button\u003e\n\n  \u003c/div\u003e\n\n  \u003c!-- Schermata del gioco --\u003e\n\n  \u003cdiv id\u003d\"gameScreen\" class\u003d\"container\" style\u003d\"display: none\"\u003e\n\n  \u003c!-- üîπ Video mostrato mentre si carica la parola segreta --\u003e\n  \u003cdiv id\u003d\"loadingParola\" class\u003d\"loading\" style\u003d\"display: none;\"\u003e\n    \u003cvideo autoplay loop muted playsinline\u003e\n      \u003csource src\u003d\"https://cdn-icons-mp4.flaticon.com/512/8722/8722522.mp4\" type\u003d\"video/mp4\" /\u003e \u003c!-- Sostituisci XXX con il tuo link --\u003e\n    \u003c/video\u003e\n    \u003cdiv\u003e\u003cem\u003eSto scegliendo la parola segreta...\u003c/em\u003e\u003c/div\u003e\n  \u003c/div\u003e\n\n  \u003c!-- üîπ Mostrata solo quando la parola √® pronta --\u003e\n  \u003cdiv id\u003d\"parolaSegreta\" class\u003d\"segreta\"\u003e\u003c/div\u003e\n\n  \u003cdiv id\u003d\"sequenza\" class\u003d\"sequenza\"\u003eSequenza: \u003c/div\u003e\n\n  \u003cdiv id\u003d\"inputArea\" class\u003d\"input-area\"\u003e\n    \u003clabel for\u003d\"inputParola\"\u003eInserisci una parola:\u003c/label\u003e\u003cbr /\u003e\n    \u003cinput type\u003d\"text\" id\u003d\"inputParola\" /\u003e\n    \u003cbutton id\u003d\"btnInvia\" class\u003d\"btn-primary\" onclick\u003d\"inviaParolaUtente()\"\u003eInvia\u003c/button\u003e\n  \u003c/div\u003e\n\n  \u003cdiv id\u003d\"loading\" class\u003d\"loading\"\u003e\n    \u003cvideo autoplay loop muted playsinline\u003e\n      \u003csource src\u003d\"https://cdn-icons-mp4.flaticon.com/512/17569/17569420.mp4\" type\u003d\"video/mp4\" /\u003e\n    \u003c/video\u003e\n    \u003cdiv\u003e\u003cem\u003eSpetta un po\u0027, sto pensando...\u003c/em\u003e\u003c/div\u003e\n  \u003c/div\u003e\n\n  \u003cdiv style\u003d\"margin-top: 20px;\"\u003e\n    \u003cbutton class\u003d\"btn-danger\" onclick\u003d\"terminaGioco()\"\u003eTermina il gioco\u003c/button\u003e\n    \u003cbutton class\u003d\"btn-success\" onclick\u003d\"redoGioco()\"\u003e‚Ü∫\u003c/button\u003e\n  \u003c/div\u003e\n\n\u003c/div\u003e\n\n\n  \u003c!-- Modal valutazione AI --\u003e\n\n  \u003cdiv id\u003d\"modalAI\"\u003e\n\n    \u003cdiv id\u003d\"modalContent\"\u003e\n\n      \u003cp\u003eRitieni che l\u0027AI fosse allineata?\u003c/p\u003e\n\n      \u003cbutton class\u003d\"btn-success\" onclick\u003d\"rispostaAI(\u0027SI\u0027)\"\u003eSI\u003c/button\u003e\n\n      \u003cbutton class\u003d\"btn-danger\" onclick\u003d\"rispostaAI(\u0027NO\u0027)\"\u003eNO\u003c/button\u003e\n\n    \u003c/div\u003e\n\n  \u003c/div\u003e\n\n\u003c/body\u003e\n\n\u003c/html\u003e\n\n"}]}